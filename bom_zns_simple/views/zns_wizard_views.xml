<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Enhanced ZNS Send Wizard Views with Parameter Mapping -->
    <record id="zns_send_wizard_form_enhanced" model="ir.ui.view">
        <field name="name">zns.send.wizard.form.enhanced</field>
        <field name="model">zns.send.wizard</field>
        <field name="arch" type="xml">
            <form string="Send ZNS Message">
                <header>
                    <button name="action_auto_detect_template" string="Auto-Detect Template" 
                            type="object" class="btn-info" attrs="{'invisible': [('sale_order_id', '=', False), ('invoice_id', '=', False)]}"/>
                    <button name="action_auto_fill_from_template" string="Auto-Fill from Mapping" 
                            type="object" class="btn-secondary" attrs="{'invisible': [('template_id', '=', False)]}"/>
                    <button name="action_preview_message" string="Preview Message" type="object" class="btn-warning"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <h1>ðŸ“± Send ZNS Message</h1>
                    </div>
                    
                    <group>
                        <group string="Template Selection">
                            <field name="use_mapping"/>
                            <field name="template_mapping_id" attrs="{'invisible': [('use_mapping', '=', False)], 'required': [('use_mapping', '=', True)]}"/>
                            <field name="template_id" attrs="{'invisible': [('use_mapping', '=', True)]}"/>
                            <field name="connection_id" readonly="1"/>
                        </group>
                        <group string="Recipient">
                            <field name="partner_id"/>
                            <field name="phone"/>
                            <field name="auto_fill_params"/>
                        </group>
                    </group>
                    
                    <!-- Context fields (hidden) -->
                    <group invisible="1">
                        <field name="sale_order_id"/>
                        <field name="invoice_id"/>
                        <field name="show_preview"/>
                    </group>
                    
                    <notebook>
                        <page string="Parameters" name="parameters" attrs="{'invisible': [('template_id', '=', False)]}">
                            <div class="alert alert-info">
                                <h4>ðŸ“‹ Parameter Mapping</h4>
                                <p>Parameters are automatically mapped from the selected template field mappings. 
                                Values in <strong>blue</strong> are auto-filled from Sale Order data.</p>
                                <p>
                                    <button name="action_auto_fill_from_template" string="ðŸ”„ Refresh Auto-Fill" 
                                            type="object" class="btn btn-sm btn-secondary"/>
                                </p>
                            </div>
                            
                            <field name="parameter_ids" nolabel="1">
                                <tree editable="bottom" decoration-info="mapping_info!=False">
                                    <field name="title"/>
                                    <field name="name" invisible="1"/>
                                    <field name="param_type" invisible="1"/>
                                    <field name="required" invisible="1"/>
                                    <field name="value" attrs="{'required': [('required', '=', True)]}"/>
                                    <field name="mapping_info" string="Auto-Mapped From" optional="show"/>
                                    <field name="so_field_mapping" invisible="1"/>
                                </tree>
                            </field>
                        </page>
                        
                        <page string="Preview" name="preview" attrs="{'invisible': [('show_preview', '=', False)]}">
                            <div class="alert alert-success">
                                <h4>ðŸ“± Message Preview</h4>
                                <p>This is how your ZNS message will be sent:</p>
                            </div>
                            <field name="preview_message" widget="text" readonly="1" nolabel="1"/>
                        </page>
                        
                        <page string="Help" name="help">
                            <div class="alert alert-info">
                                <h4>ðŸ’¡ How to Use This Wizard</h4>
                                
                                <h5>1. Template Selection</h5>
                                <ul>
                                    <li><strong>Use Template Mapping:</strong> Automatically select template based on order conditions</li>
                                    <li><strong>Manual Selection:</strong> Choose template directly</li>
                                    <li><strong>Auto-Detect:</strong> Find best template for current Sale Order</li>
                                </ul>
                                
                                <h5>2. Parameter Auto-Fill</h5>
                                <ul>
                                    <li><strong>Auto-fill Parameters:</strong> Automatically populate from Sale Order data</li>
                                    <li><strong>Template Mappings:</strong> Use field mappings configured in template</li>
                                    <li><strong>Manual Override:</strong> Edit any parameter value manually</li>
                                </ul>
                                
                                <h5>3. Common Parameters</h5>
                                <div class="row">
                                    <div class="col-md-6">
                                        <strong>Customer Info:</strong><br/>
                                        â€¢ customer_name â†’ Customer Name<br/>
                                        â€¢ customer_phone â†’ Mobile/Phone<br/>
                                        â€¢ customer_email â†’ Email<br/>
                                    </div>
                                    <div class="col-md-6">
                                        <strong>Order Info:</strong><br/>
                                        â€¢ so_no â†’ SO Number<br/>
                                        â€¢ amount â†’ Total Amount<br/>
                                        â€¢ order_date â†’ Order Date<br/>
                                    </div>
                                </div>
                                
                                <h5>4. Preview and Send</h5>
                                <ul>
                                    <li><strong>Preview Message:</strong> See exactly what will be sent</li>
                                    <li><strong>Validation:</strong> Required parameters must be filled</li>
                                    <li><strong>Send:</strong> Message is sent immediately via BOM API</li>
                                </ul>
                            </div>
                        </page>
                    </notebook>
                </sheet>
                <footer>
                    <button name="send_message" string="ðŸ“¤ Send ZNS" type="object" class="btn-primary"/>
                    <button string="Cancel" class="btn-secondary" special="cancel"/>
                </footer>
            </form>
        </field>
    </record>

    <!-- Parameter Form View -->
    <record id="zns_send_wizard_parameter_form" model="ir.ui.view">
        <field name="name">zns.send.wizard.parameter.form</field>
        <field name="model">zns.send.wizard.parameter</field>
        <field name="arch" type="xml">
            <form string="Parameter">
                <group>
                    <group>
                        <field name="title"/>
                        <field name="name"/>
                        <field name="param_type"/>
                        <field name="required"/>
                    </group>
                    <group>
                        <field name="value"/>
                        <field name="mapping_info" readonly="1"/>
                        <field name="so_field_mapping" readonly="1"/>
                    </group>
                </group>
            </form>
        </field>
    </record>
</odoo>